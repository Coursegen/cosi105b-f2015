<!DOCTYPE HTML>
<html lang="en">
  <head>
    <title>Refactoring and Smell Exercise - Cosi 105b</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="/bootstrap/css/custom.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="/tipuesearch/tipuesearch_set.js"></script>
    <script src="/tipuesearch/tipuesearch_content.js"></script>
    <script src="/tipuesearch/tipuesearchmin.js"></script>

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 4.0.0rc2">
  </head>
  <body>

    
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
  <div class="row">
    <div class="col-xs-7">
      <a class="navbar-brand" href="/">Cosi 105b - Software Engineering for Scalability </a>
    </div>
    <div class="col-xs-2">
      <div class="btn-group">
        
          <a class="btn btn-mini" href="/content/topics/exercises/pricing_model_exercise.md/"><i class="glyphicon glyphicon-chevron-left" rel="tooltip" title="previous page"></i></a> <a class="btn btn-mini" href="/content/topics/exercises/smell_exercise.md/"><i class="glyphicon glyphicon-chevron-right" rel="tooltip" title="next page"></i></a>
        
      </div>
    </div>
    <div class="col-xs-3">
    <form role="form" class="form-inline" action="/tipuesearch_logic/search/index.html">
      <div class="input-group input-group-sm">
        <input type="text" class="form-control" placeholder="search..." name="q" id="tipue_search_input" autocomplete="off" required>
      </div>
    </form>
    </div>
  </div>
</div>

    </div>
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
        <h3>
	Refactoring and Smell Exercise
	
</h4>

        </div>
      </div>
      <div class="row">
        <div class="col-xs-9">
          
<h4 id="your-assignment">Your assignment</h4>

<h5 id="on-your-own">On your own</h5>
<ol>
  <li>Clone this repository to your portfolio so you can work on it: https://github.com/pitosalas/refactor_first.git</li>
  <li>Run the rental_test.rb unit test. Each “dot” is a passing test</li>
  <li>Read it and understand all the files. See the <strong>Tour of the Code</strong> below.</li>
  <li>Read my description of the <strong>Smells In The Code</strong> below.</li>
  <li>Read this detailed chapter about the “Compose Method refactoring” from a famous book: <a href="http://www.informit.com/articles/article.aspx?p=1398607">Compose Method</a></li>
  <li>Refactor the program to make it better</li>
  <li>Use the unit test to make sure that your program continues to work whenever you make a change.</li>
</ol>

<h5 id="find-one-or-two-other-students-to-work-with-total-of-3-students-max-per-group">Find one or two other students to work with (total of 3 students max per group)</h5>
<ol>
  <li>On your own, try to come up with how to improve the code. You will be doing some “refactoring” which is a fancy way to say changing the code that is written without changing it’s functionality in any way. Take 30 minutes or less doing this.</li>
  <li>Find 1 or 2 other students in our class to work with. This can be in person or over email. Please keep it honest and make sure the other students did the “on your own” part also and really worked on the code.
    <ul>
      <li>Discuss each person’s views on the smells. Why are they a problem? How could they be improved? Together write the best improved version of this program using your best ideas.</li>
    </ul>
  </li>
  <li>Write up a joint summary of your work (remember to include your names!). Discuss:
    <ul>
      <li>What new Ruby you had to learn to accomplish this</li>
      <li>Explain each change you made an why you made it</li>
      <li>To give me useful feedback</li>
      <li>How much time did you work by yourself (each name)</li>
      <li>How much time did you work as a group</li>
      <li>What do you think of this assignment?</li>
    </ul>
  </li>
  <li>Combine the PDF of the summary and all the new .rb files into a .zip file and submit that</li>
</ol>

<h4 id="tour-of-the-code-a-simple-movie-rental-store">Tour of the code: a simple movie rental store</h4>

<h5 id="rentaltestrb">rental_test.rb</h5>
<ul>
  <li>I am using a simple testing framework called “minitest”. This is your first exposure to unit testing, a topic we are going to go much deeper into. It is all just regular ruby
    <ul>
      <li>Line 6: a set of tests is given a name with a <code>describe</code> block</li>
      <li>line 7: Each time a test is run, the <code>setup</code> block is called to prepare variables</li>
      <li>line 17: Each individual test may start with an <code>it</code> block</li>
      <li>line 19: A <code>must_equal</code> method can be called on anything to check that the value is what is expected.</li>
    </ul>
  </li>
  <li>You can have many <code>it</code> blocks for many individual tests</li>
  <li>If any of the <code>must</code> equal blocks fail that is displayed for you.</li>
  <li>You can run the test simply by doing <code>ruby rental_test.rb</code> because it is a regular ruby file</li>
</ul>

<h5 id="movierb">movie.rb</h5>
<ul>
  <li>Movies have a title and a price code</li>
  <li>Movies can have one of three price codes</li>
</ul>

<h5 id="rentalrb">rental.rb</h5>
<ul>
  <li>One act of renting a movie</li>
  <li>Captures what movie is rented, and for how many days
    <ul>
      <li>Line 6: Notice the parallel assignment, equivalent to two statements, @movie = movie; @days_rented = days_rented</li>
    </ul>
  </li>
</ul>

<h5 id="customerrb">customer.rb</h5>
<ul>
  <li>One customer, tracks the customer’s name and rental history</li>
  <li>The key method is <code>statement</code>. It returns a statement of the customers rental history for the customer, what movies were rented, how much each cost, and also accounts for their accumulated frequent renter points
    <ul>
      <li>Line 11: <code>@rentals &lt;&lt; arg</code> means to add a new element at the end of the array <code>@rentals</code></li>
      <li>Line 22: the format <code>Movie::REGULAR</code> means to look inside the <code>Movie</code> class for a constant <code>called REGULAR</code></li>
    </ul>
  </li>
</ul>

<h4 id="smells-in-this-code">Smells in this code</h4>
<ul>
  <li>I see several smells in this code. Do you? The <code>statement</code> method is way too long. Also it has a case statement based on a kind of a type_code. And definitely it has multiple responsibilities. There are other smells also.</li>
  <li>We are going to approach fixing the long <code>statement</code> method by appliying a refactoring called “Compose Method”. There are lots of links about Compose method that you can read up on. My summary of it is:
    <ul>
      <li>Transform a long method so that you can readily understand it’s logic</li>
      <li>Do this by identifying groups of lines which can be grouped logically</li>
      <li>Move each of those lines into a separate method. It’s a good sign if you have a meaningful, intention revealing name for that method</li>
      <li>In the end, transform the original method’s logic into a small number of intention-revealing steps at the same level of detail.</li>
    </ul>
  </li>
  <li>Notice again the use of a “type_code” to distinguish the three kinds of movie. Like I said in the last exercise, this is a likely code smell and ought to be eliminated.</li>
</ul>


        </div>
        <div class="col-xs-3">
          <div class="row well right-nav" style="color: rgb(158, 48, 48);padding-top: 4px;padding-bottom: 4px;padding-left: 8px;padding-right: 8px;margin-bottom: 8px;">
            <div id="helpful" class="text-center">Was this helpful!?
    <a id="yes-link">yes</a> / <a id="no-link">no</a>
</div>
          </div>
          <div class="row well right-nav" style="padding: 5px;">
            <ul>
              
                <li>
            <label class="tree-toggler level1">
              <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span>
              Intro
            </label><ul class="tree" style="display: block"><li class=""><span class="glyphicon glyphicon-star" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/intro/course_toc.md/">List of lectures</a></li><li class=""><span class="glyphicon glyphicon-star" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/intro/portfolio.md/">Code Portfolio</a></li></ul></li>
              
                <li>
            <label class="tree-toggler level1">
              <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span>
              Lectures
            </label><ul class="tree">
      <li>
        <label class="tree-toggler level2">
          <span class="glyphicon glyphicon-plus-sign" style="font-size: 60%; width: 10px; color: grey"></span> 
          Software Design
        </label>
        <ul class="tree" style="display: none"><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part1/01_welcome.md/">Welcome</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part1/02_warm_up_1.md/">Ruby Firehose Part 1</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part1/03_warm_up_2.md/">Ruby and Intro to Object Oriented</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part1/04_software_engineeringbasics.md/">Software Engineering</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part1/06_software_design.md/">Software Design</a></li></ul>
      </li>
    </ul><ul class="tree">
      <li>
        <label class="tree-toggler level2">
          <span class="glyphicon glyphicon-plus-sign" style="font-size: 60%; width: 10px; color: grey"></span> 
          nano Twitter (nT)
        </label>
        <ul class="tree" style="display: none"><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part2/01_serv_fund.md/">Server Fundamentals</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part2/02_database_fund.md/">Database Basics</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part2/03_sinatra_intro.md/">Introduction to Sinatra</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part2/04_twitter_case.md/">Twitter Case Study</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part2/05_more_sinatra.md/">Persistence and Web services</a></li></ul>
      </li>
    </ul><ul class="tree">
      <li>
        <label class="tree-toggler level2">
          <span class="glyphicon glyphicon-plus-sign" style="font-size: 60%; width: 10px; color: grey"></span> 
          Scaling Basics
        </label>
        <ul class="tree" style="display: none"><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part3/01_scaling_intro.md/">Intro to Scaling</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part3/02_architecting_for_scale.md/">Architecting for scale</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part3/03_web_services.md/">Introduction to Web Services</a></li></ul>
      </li>
    </ul><ul class="tree">
      <li>
        <label class="tree-toggler level2">
          <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span> 
          Building Software
        </label>
        <ul class="tree" style="display: block"><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part4/01_review_topics.md/">Review topics</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part4/02_oo_inheritance.md/">OO - Inheritance</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part4/03_tdd.md/">TDD</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part4/04_testing.md/">Software Testing</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part4/05_patterns.md/">Design Patterns</a></li></ul>
      </li>
    </ul><ul class="tree">
      <li>
        <label class="tree-toggler level2">
          <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span> 
          Design at Scale
        </label>
        <ul class="tree" style="display: block"><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/01_scaling_patterns.md/">Scaling Patterns</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/02_scaling_patterns_continued.md/">Scaling Patterns</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/03_projects.md/">Projects Discussion</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/04_review.md/">Review and Discussion</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/05_realworld.md/">Real World Survival Kit</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/06_conclusion.md/">Last Class</a></li></ul>
      </li>
    </ul></li>
              
                <li>
            <label class="tree-toggler level1">
              <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span>
              Background
            </label><ul class="tree" style="display: block"><li class=""><a href="/content/background/code_reading_request.md/">Code Reading</a></li><li class=""><a href="/content/background/grading.md/">Grading</a></li><li class=""><a href="/content/background/leveling.md/">Leveling exercise</a></li><li class=""><a href="/content/background/pa.md/">Programming Assignments</a></li><li class=""><a href="/content/background/prework.md/">Recommended Pre-Work</a></li></ul></li>
              
                <li>
            <label class="tree-toggler level1">
              <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span>
              NanoTwitter
            </label><ul class="tree" style="display: block"><li class=""><a href="/content/nt/01_nt_functionality.md/">nano Twitter Functionality</a></li><li class=""><a href="/content/nt/02_nt_arch.md/">NT Design and Architecture</a></li><li class=""><a href="/content/nt/03_nt_outline.md/">Nano Twitter Project Outline</a></li><li class=""><a href="/content/nt/04_references.md/">Aggregated Twitter Bibliography</a></li></ul></li>
              
                
              
                
              
            </ul>
          </div>
        </div>
      </div>
      <div class="container">
  <div class="row">
    <div class="col-xs-12">
      <footer>Copyright (2014-2015) R. Pito Salas, pitosalas@gmail.com</footer>
      </div>
  </div>
</div>


    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <script src="/bootstrap/js/custom.js"></script>
    <script src="/chalkmark/chalkmark.js"></script>
    <script> $(document).ready(function() {
      $('#tipue_search_input').tipuesearch({'highlightEveryTerm': true, 'show': 8, 'showURL': false, 'descriptiveWords': 50});
    });</script>
  </body>
</html>
