<!DOCTYPE HTML>
<html lang="en">
  <head>
    <title>Smell Exercise - Cosi 105b</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="/bootstrap/css/custom.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="/tipuesearch/tipuesearch_set.js"></script>
    <script src="/tipuesearch/tipuesearch_content.js"></script>
    <script src="/tipuesearch/tipuesearchmin.js"></script>

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 4.0.0rc2">
  </head>
  <body>

    
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
  <div class="row">
    <div class="col-xs-7">
      <a class="navbar-brand" href="/">Cosi 105b - Software Engineering for Scalability </a>
    </div>
    <div class="col-xs-2">
      <div class="btn-group">
        
          <a class="btn btn-mini" href="/content/topics/exercises/refactor_ex.md/"><i class="glyphicon glyphicon-chevron-left" rel="tooltip" title="previous page"></i></a> <a class="btn btn-mini" href="/content/topics/exercises/ux_review_exercise.md/"><i class="glyphicon glyphicon-chevron-right" rel="tooltip" title="next page"></i></a>
        
      </div>
    </div>
    <div class="col-xs-3">
    <form role="form" class="form-inline" action="/tipuesearch_logic/search/index.html">
      <div class="input-group input-group-sm">
        <input type="text" class="form-control" placeholder="search..." name="q" id="tipue_search_input" autocomplete="off" required>
      </div>
    </form>
    </div>
  </div>
</div>

    </div>
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
        <h3>
	Smell Exercise
	
</h4>

        </div>
      </div>
      <div class="row">
        <div class="col-xs-9">
          <ul>
  <li>Take a look at the code below. You can copy it into your own text editor</li>
  <li>Run it and understand what it does</li>
  <li>Concentrate on two code smells:
    <ol>
      <li>The unusual way that params.each works (line 3). Try to figure out what exactly that line is doing. Yes it’s pretty clever but why did I write it that way, and what are some problems with that?</li>
      <li>The convoluted way that price is computed (line 21). Generally when you have a nested calculation like that, and secondly when a class has some kind of “code” to distinguish types, this is a code smell and tells us that there’s room for improvement.</li>
      <li>And of course, this method is much longer than it should be.</li>
    </ol>
  </li>
  <li>Exercise:
    <ol>
      <li>Think: For 5-10 minutes, try to come up with how to improve the code. You will be doing some “refactoring” which is a fancy way to say changing the code that is written without changing it’s functionality in any way.</li>
      <li>Pair: For 5-15 minutes, discuss your solutions or ideas or questions with one or two other students sitting near you. Write an improved version of this program using the best ideas from all of you.</li>
      <li>Share: I will invite various groups to talk about their solutions and proposals and bring you up to the board to present.</li>
    </ol>
  </li>
</ul>

<h4 id="discussion">Discussion</h4>
<ul>
  <li>What new Ruby did you have to learn to solve this?</li>
  <li>Is the new code shorter or longer than the old one?</li>
  <li>In what ways do you think it’s an improvement?</li>
  <li>Do you want to see my solution?</li>
</ul>

<h4 id="heres-the-code">Here’s the code:</h4>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MountainBike</span>
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>  <span style="color:#036;font-weight:bold">TIRE_WIDTH_FACTOR</span> = <span style="color:#00D">250</span>
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>  <span style="color:#036;font-weight:bold">FRONT_SUSPENSION_FACTOR</span> = <span style="color:#00D">100</span>
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>  <span style="color:#036;font-weight:bold">REAR_SUSPENSION_FACTOR</span> = <span style="color:#00D">150</span>
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">initialize</span>(params)
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>    params.each { |key, value| instance_variable_set <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">@</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>key<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>, value }
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>    
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>    <span style="color:#33B">@commission</span> = <span style="color:#60E">0.25</span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>    <span style="color:#33B">@front_suspension_price</span> = <span style="color:#60E">95.0</span>
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>    <span style="color:#33B">@rear_suspension_price</span> = <span style="color:#60E">67.0</span>
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>    <span style="color:#33B">@base_price</span> = <span style="color:#60E">490.00</span>
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>  <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n15" name="n15">15</a></span>
<span class="line-numbers"><a href="#n16" name="n16">16</a></span>  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">off_road_ability</span>
<span class="line-numbers"><a href="#n17" name="n17">17</a></span>    result = <span style="color:#33B">@tire_width</span> * <span style="color:#036;font-weight:bold">TIRE_WIDTH_FACTOR</span>
<span class="line-numbers"><a href="#n18" name="n18">18</a></span>    <span style="color:#080;font-weight:bold">if</span> <span style="color:#33B">@type_code</span> == <span style="color:#A60">:front_suspension</span> || <span style="color:#33B">@type_code</span> == <span style="color:#A60">:full_suspension</span>
<span class="line-numbers"><a href="#n19" name="n19">19</a></span>      result += <span style="color:#33B">@front_fork_travel</span> * <span style="color:#036;font-weight:bold">FRONT_SUSPENSION_FACTOR</span>
<span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>    <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n21" name="n21">21</a></span>    <span style="color:#080;font-weight:bold">if</span> <span style="color:#33B">@type_code</span> == <span style="color:#A60">:full_suspension</span>
<span class="line-numbers"><a href="#n22" name="n22">22</a></span>      result += <span style="color:#33B">@rear_fork_travel</span> * <span style="color:#036;font-weight:bold">REAR_SUSPENSION_FACTOR</span>
<span class="line-numbers"><a href="#n23" name="n23">23</a></span>    <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n24" name="n24">24</a></span>    result
<span class="line-numbers"><a href="#n25" name="n25">25</a></span>  <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n26" name="n26">26</a></span>  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">price</span>
<span class="line-numbers"><a href="#n27" name="n27">27</a></span>    <span style="color:#080;font-weight:bold">case</span> <span style="color:#33B">@type_code</span>
<span class="line-numbers"><a href="#n28" name="n28">28</a></span>    <span style="color:#080;font-weight:bold">when</span> <span style="color:#A60">:rigid</span>
<span class="line-numbers"><a href="#n29" name="n29">29</a></span>      (<span style="color:#00D">1</span> + <span style="color:#33B">@commission</span>) * <span style="color:#33B">@base_price</span>
<span class="line-numbers"><strong><a href="#n30" name="n30">30</a></strong></span>    <span style="color:#080;font-weight:bold">when</span> <span style="color:#A60">:front_suspension</span>
<span class="line-numbers"><a href="#n31" name="n31">31</a></span>      (<span style="color:#00D">1</span> + <span style="color:#33B">@commission</span>) * <span style="color:#33B">@base_price</span> + <span style="color:#33B">@front_suspension_price</span>
<span class="line-numbers"><a href="#n32" name="n32">32</a></span>    <span style="color:#080;font-weight:bold">when</span> <span style="color:#A60">:full_suspension</span>
<span class="line-numbers"><a href="#n33" name="n33">33</a></span>      (<span style="color:#00D">1</span> + <span style="color:#33B">@commission</span>) * <span style="color:#33B">@base_price</span> + <span style="color:#33B">@front_suspension_price</span> +
<span class="line-numbers"><a href="#n34" name="n34">34</a></span>        <span style="color:#33B">@rear_suspension_price</span>
<span class="line-numbers"><a href="#n35" name="n35">35</a></span>    <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n36" name="n36">36</a></span>  <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n37" name="n37">37</a></span>
<span class="line-numbers"><a href="#n38" name="n38">38</a></span>  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">owner</span>
<span class="line-numbers"><a href="#n39" name="n39">39</a></span>    <span style="color:#33B">@owner</span>
<span class="line-numbers"><strong><a href="#n40" name="n40">40</a></strong></span>  <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n41" name="n41">41</a></span>
<span class="line-numbers"><a href="#n42" name="n42">42</a></span>  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">to_s</span>
<span class="line-numbers"><a href="#n43" name="n43">43</a></span>    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Mountain bike - owner: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>owner<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">, off road ability: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>off_road_ability()<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">, price: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>price<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
<span class="line-numbers"><a href="#n44" name="n44">44</a></span>  <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n45" name="n45">45</a></span>
<span class="line-numbers"><a href="#n46" name="n46">46</a></span><span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n47" name="n47">47</a></span>
<span class="line-numbers"><a href="#n48" name="n48">48</a></span>pitos_bike = <span style="color:#036;font-weight:bold">MountainBike</span>.new(<span style="color:#A60">:owner</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Pito</span><span style="color:#710">&quot;</span></span>, <span style="color:#A60">:type_code</span> =&gt; <span style="color:#A60">:rigid</span>, <span style="color:#A60">:tire_width</span> =&gt; <span style="color:#60E">2.5</span>)
<span class="line-numbers"><a href="#n49" name="n49">49</a></span>puts pitos_bike
<span class="line-numbers"><strong><a href="#n50" name="n50">50</a></strong></span>
<span class="line-numbers"><a href="#n51" name="n51">51</a></span>ricks_bike = <span style="color:#036;font-weight:bold">MountainBike</span>.new(<span style="color:#A60">:owner</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Rick</span><span style="color:#710">&quot;</span></span>, <span style="color:#A60">:type_code</span> =&gt; <span style="color:#A60">:front_suspension</span>, <span style="color:#A60">:tire_width</span> =&gt; <span style="color:#00D">2</span>, <span style="color:#A60">:front_fork_travel</span> =&gt; <span style="color:#00D">3</span>)
<span class="line-numbers"><a href="#n52" name="n52">52</a></span>puts ricks_bike
<span class="line-numbers"><a href="#n53" name="n53">53</a></span>
<span class="line-numbers"><a href="#n54" name="n54">54</a></span>
<span class="line-numbers"><a href="#n55" name="n55">55</a></span>
<span class="line-numbers"><a href="#n56" name="n56">56</a></span>
</pre></div>
</div>
</div>


        </div>
        <div class="col-xs-3">
          <div class="row well right-nav" style="color: rgb(158, 48, 48);padding-top: 4px;padding-bottom: 4px;padding-left: 8px;padding-right: 8px;margin-bottom: 8px;">
            <div id="helpful" class="text-center">Was this helpful!?
    <a id="yes-link">yes</a> / <a id="no-link">no</a>
</div>

          </div>
          <div class="row well right-nav" style="padding: 5px;">
            <ul>
              
                <li>
            <label class="tree-toggler level1">
              <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span>
              Intro
            </label><ul class="tree" style="display: block"><li class=""><span class="glyphicon glyphicon-star" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/intro/course_toc.md/">List of lectures</a></li><li class=""><span class="glyphicon glyphicon-star" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/intro/portfolio.md/">Code Portfolio</a></li><li class=""><span class="glyphicon glyphicon-star" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/intro/prework.md/">Recommended Pre-Work</a></li></ul></li>
              
                <li>
            <label class="tree-toggler level1">
              <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span>
              Lectures
            </label><ul class="tree">
      <li>
        <label class="tree-toggler level2">
          <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span> 
          Software Design
        </label>
        <ul class="tree" style="display: block"><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part1/01_welcome.md/">Welcome</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part1/02_ruby_firehose.md/">Ruby Firehose Part 1</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part1/03_intro_oo.md/">Ruby and Intro to Object Oriented</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part1/04_software_engineeringbasics.md/">Software Engineering</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part1/05_good_programming_practices.md/">Good Programming Practices</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part1/06_software_design.md/">Software Design</a></li></ul>
      </li>
    </ul><ul class="tree">
      <li>
        <label class="tree-toggler level2">
          <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span> 
          nano Twitter (nT)
        </label>
        <ul class="tree" style="display: block"><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part2/01_serv_fund.md/">Server Fundamentals</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part2/02_database_fund.md/">Database Basics</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part2/03_sinatra_intro.md/">Introduction to Sinatra</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part2/04_twitter_case.md/">Twitter Case Study</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part2/05_more_sinatra.md/">Persistence and Web services</a></li></ul>
      </li>
    </ul><ul class="tree">
      <li>
        <label class="tree-toggler level2">
          <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span> 
          Scaling Basics
        </label>
        <ul class="tree" style="display: block"><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part3/01_scaling_intro.md/">Intro to Scaling</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part3/02_architecting_for_scale.md/">Architecting for scale</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part3/03_web_services.md/">Introduction to Web Services</a></li></ul>
      </li>
    </ul><ul class="tree">
      <li>
        <label class="tree-toggler level2">
          <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span> 
          Building Software
        </label>
        <ul class="tree" style="display: block"><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part4/01_review_topics.md/">Review topics</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part4/02_oo_inheritance.md/">OO - Inheritance</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part4/03_tdd.md/">TDD</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part4/04_testing.md/">Software Testing</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part4/05_patterns.md/">Design Patterns</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part4/06_practice.md/">Practice</a></li></ul>
      </li>
    </ul><ul class="tree">
      <li>
        <label class="tree-toggler level2">
          <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span> 
          Design at Scale
        </label>
        <ul class="tree" style="display: block"><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/01_scaling_patterns.md/">Scaling Patterns</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/02_scaling_patterns_continued.md/">Scaling Patterns</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/03_projects.md/">Projects Discussion</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/04_review.md/">Review and Discussion</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/05_realworld.md/">Real World Survival Kit</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/06_conclusion.md/">Last Class</a></li></ul>
      </li>
    </ul></li>
              
                <li>
            <label class="tree-toggler level1">
              <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span>
              Background
            </label><ul class="tree" style="display: block"><li class=""><a href="/content/background/grading.md/">Grading</a></li><li class=""><a href="/content/background/leveling.md/">Leveling exercise</a></li><li class=""><a href="/content/background/pa.md/">Programming Assignments</a></li></ul></li>
              
                <li>
            <label class="tree-toggler level1">
              <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span>
              NanoTwitter
            </label><ul class="tree" style="display: block"><li class=""><a href="/content/nt/01_nt_functionality.md/">nano Twitter Functionality</a></li><li class=""><a href="/content/nt/02_nt_arch.md/">NT Design and Architecture</a></li><li class=""><a href="/content/nt/03_nt_outline.md/">Nano Twitter Project Outline</a></li><li class=""><a href="/content/nt/04_references.md/">Aggregated Twitter Bibliography</a></li></ul></li>
              
                
              
                
              
            </ul>
          </div>
        </div>
      </div>
      <div class="container">
  <div class="row">
    <div class="col-xs-12">
      <footer>Copyright (2014-2015) R. Pito Salas, pitosalas@gmail.com</footer>
      </div>
  </div>
</div>


    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <script src="/bootstrap/js/custom.js"></script>
    <script src="/chalkmark/chalkmark.js"></script>
    <script> $(document).ready(function() {
      $('#tipue_search_input').tipuesearch({'highlightEveryTerm': true, 'show': 8, 'showURL': false, 'descriptiveWords': 50});
    });</script>
  </body>
</html>
