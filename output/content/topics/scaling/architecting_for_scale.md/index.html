<!DOCTYPE HTML>
<html lang="en">
  <head>
    <title>Architecting for Scale - Cosi 105b</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="/bootstrap/css/custom.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="/tipuesearch/tipuesearch_set.js"></script>
    <script src="/tipuesearch/tipuesearch_content.js"></script>
    <script src="/tipuesearch/tipuesearchmin.js"></script>

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 4.0.0rc2">
  </head>
  <body>

    
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
  <div class="row">
    <div class="col-xs-7">
      <a class="navbar-brand" href="/">Cosi 105b - Software Engineering and Architecture at Scale</a>
    </div>
    <div class="col-xs-2">
      <div class="btn-group">
        
          <a class="btn btn-mini" href="/content/topics/README/"><i class="glyphicon glyphicon-chevron-left" rel="tooltip" title="previous page"></i></a> <a class="btn btn-mini" href="/content/topics/scaling/scaling.md/"><i class="glyphicon glyphicon-chevron-right" rel="tooltip" title="next page"></i></a>
        
      </div>
    </div>
    <div class="col-xs-3">
    <form role="form" class="form-inline" action="/tipuesearch_logic/search/index.html">
      <div class="input-group input-group-sm">
        <input type="text" class="form-control" placeholder="search..." name="q" id="tipue_search_input" autocomplete="off" required>
      </div>
    </form>
    </div>
  </div>
</div>

    </div>
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
        <h3>
	Architecting for Scale
	
</h4>

        </div>
      </div>
      <div class="row">
        <div class="col-xs-9">
          
<h4 id="architecting-for-scale">Architecting for scale</h4>
<div class="well well-sm">
<span class="label label-primary">YAGNI</span> Never do extra work for scaling until measurement reveals there's a problem and where the problem is.
</div>

<h4 id="base-configuration">Base configuration</h4>
<ul>
  <li>We start with the simplest possible set up. If you have stand alone servers (which we don’t) you would run the database and web server on the same box.</li>
  <li>In our case we are deploying to a cloud server, where you aren’t getting a full box but a virtual slice, from e.g. Heroku. In that case our base configuration is a single “web worker” to run Sinatra and a single “database” to run our database, which would be Postgress.</li>
  <li>With that base, measure performance. If you have a real load, you can measure. In our case we have to create an artificial load send traffic to the server. We want to see how many simultanuous sessions we support.</li>
</ul>

<h4 id="stage-one-scalability-tuning">Stage One Scalability Tuning</h4>
<ul>
  <li>Analyze and think abou whether the servers are poweful enough. Is it your old laptop running a database server or is it a fairly new computer with no other load. If you are using a cloud service, like BlueMix, Heroku or Digital Ocean, what kind of virtual capacity or limits does it have? You might need to simply up the capacity.</li>
  <li>Examine your database access and queries. Can you determine that pages that don’t have a database call are really fast and the ones that do are slower? Can you see what pages slow down the most?</li>
</ul>

<h4 id="if-queries-are-the-problem">If queries are the problem</h4>
<ul>
  <li>Make sure you clearly understand the separation between the web and the database server.</li>
  <li>Consider whether you should put the database on it’s own server</li>
  <li>Consider whether any tables need indexes</li>
  <li>Consider whether you are going back to the database more than a few times for each page displayed.
    <ul>
      <li>Consider whether you are hitting the database once for each record displayed (so called N+1 problem).</li>
      <li>If you are, look at making your queries ‘greedy’ meaning that they bring back more in a single call to tge server</li>
    </ul>
  </li>
  <li>Consider whether you are issuing the exact same query over and over again.</li>
  <li>Consider whether an intermediate query result that is expensive is being requested again. If so, caching those results is a strategy.</li>
  <li>Look at the metrics on your database servers, that is simple</li>
</ul>

<h4 id="if-the-appweb-server-seems-to-be-the-problem">If the app/web server seems to be the problem</h4>
<ul>
  <li>Consider whether you are fully/over utilizing resources
    <ul>
      <li>Make sure that the resources (memory, cpu) are being used but not pinned to maximum.</li>
      <li>You don’t want to hit your caps on resources, otherwise the app will start thrashing.</li>
    </ul>
  </li>
  <li>Consider adding more “web workers” or concurrent threads.
    <ul>
      <li>You have to be careful that your architecture allows that. Is your design ready to run concurrently.</li>
      <li>Is there any way that one request can corrupt another one running at the same time?</li>
    </ul>
  </li>
</ul>

<h4 id="if-you-still-have-scaling-issues">If you still have scaling issues</h4>
<ul>
  <li>Consider adding another discrete server
    <ul>
      <li>Once you see one box does not cut it any longer add another server, you will need a load balancer for this.</li>
      <li>Adding another server, increases your redundancy. Depending on how valuable this app is and how badly it needs to stay up 2 app servers is a good idea, as well as 2 database servers, 1 primary and 1 follower on stand by. AWS RDS makes that last part easy.</li>
    </ul>
  </li>
  <li>Consider caching services
    <ul>
      <li>Are there intermediate results that can be cached to avoid hitting the database at all?</li>
    </ul>
  </li>
  <li>Consider partitioning the databases
    <ul>
      <li>One replica for update transactions and multiple replicas for read transactions</li>
      <li>Partitioning vertically, by moving certain columns of tables to a separate db servers.</li>
      <li>Partitioning horizontally (sharding) by moving certain sets of rows to separate db servers. (For example, profile records for half the users on one server and the other half on another server.)</li>
    </ul>
  </li>
  <li>Consider breaking into services
    <ul>
      <li>Are there separable major bits of functionality that you can carve off into fully independent services, with their own app and db servers</li>
    </ul>
  </li>
</ul>

        </div>
        <div class="col-xs-3">
          <div class="row well right-nav" style="color: rgb(158, 48, 48);padding-top: 4px;padding-bottom: 4px;padding-left: 8px;padding-right: 8px;margin-bottom: 8px;">
            <div id="helpful" class="text-center">Was this helpful!?
    <a id="yes-link">yes</a> / <a id="no-link">no</a>
</div>
          </div>
          <div class="row well right-nav" style="padding: 5px;">
            <ul>
              
                <li>
            <label class="tree-toggler level1">
              <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span>
              Intro
            </label><ul class="tree" style="display: block"><li class=""><span class="glyphicon glyphicon-star" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/intro/code_reading_request.md/">Code Reading (By Request!)</a></li><li class=""><span class="glyphicon glyphicon-star" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/intro/course_toc.md/">List of lectures</a></li><li class=""><span class="glyphicon glyphicon-star" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/intro/portfolio.md/">Code Portfolio</a></li></ul></li>
              
                <li>
            <label class="tree-toggler level1">
              <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span>
              Lectures
            </label><ul class="tree">
      <li>
        <label class="tree-toggler level2">
          <span class="glyphicon glyphicon-plus-sign" style="font-size: 60%; width: 10px; color: grey"></span> 
          Software Design
        </label>
        <ul class="tree" style="display: none"><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part1/01_welcome.md/">Welcome</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part1/02_warm_up_1.md/">Ruby Firehose Part 1</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part1/03_warm_up_2.md/">Ruby and Intro to Object Oriented</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part1/04_software_engineeringbasics.md/">Software Engineering</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part1/06_software_design.md/">Software Design</a></li></ul>
      </li>
    </ul><ul class="tree">
      <li>
        <label class="tree-toggler level2">
          <span class="glyphicon glyphicon-plus-sign" style="font-size: 60%; width: 10px; color: grey"></span> 
          nano Twitter (nT)
        </label>
        <ul class="tree" style="display: none"><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part2/01_serv_fund.md/">Server Fundamentals</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part2/02_database_fund.md/">Database Basics</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part2/03_sinatra_intro.md/">Introduction to Sinatra</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part2/04_twitter_case.md/">Twitter Case Study</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part2/05_more_sinatra.md/">Persistence and Web services</a></li></ul>
      </li>
    </ul><ul class="tree">
      <li>
        <label class="tree-toggler level2">
          <span class="glyphicon glyphicon-plus-sign" style="font-size: 60%; width: 10px; color: grey"></span> 
          Scaling Basics
        </label>
        <ul class="tree" style="display: none"><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part3/01_scaling_intro.md/">Intro to Scaling</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part3/02_architecting_for_scale.md/">Architecting for scale</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part3/03_web_services.md/">Introduction to Web Services</a></li></ul>
      </li>
    </ul><ul class="tree">
      <li>
        <label class="tree-toggler level2">
          <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span> 
          Building Software
        </label>
        <ul class="tree" style="display: block"><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part4/01_review_topics.md/">Review topics</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part4/02_oo_inheritance.md/">OO - Inheritance</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part4/03_tdd.md/">TDD</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part4/04_testing.md/">Software Testing</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part4/05_patterns.md/">Design Patterns</a></li></ul>
      </li>
    </ul><ul class="tree">
      <li>
        <label class="tree-toggler level2">
          <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span> 
          Design at Scale
        </label>
        <ul class="tree" style="display: block"><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/01_scaling_patterns.md/">Scaling Patterns</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/02_scaling_patterns_continued.md/">Scaling Patterns</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/03_projects.md/">Projects Discussion</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/04_review.md/">Review and Discussion</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/05_realworld.md/">Real World Survival Kit</a></li><li class=""><span class="glyphicon glyphicon-minus" style="font-size: 60%; width: 10px; color: grey"></span><a href="/content/lectures/part5/06_conclusion.md/">Last Class</a></li></ul>
      </li>
    </ul></li>
              
                <li>
            <label class="tree-toggler level1">
              <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span>
              Background
            </label><ul class="tree" style="display: block"><li class=""><a href="/content/background/grading.md/">Grading</a></li><li class=""><a href="/content/background/leveling.md/">Leveling exercise</a></li><li class=""><a href="/content/background/pa.md/">Programming Assignments</a></li><li class=""><a href="/content/background/prework.md/">Recommended Pre-Work</a></li></ul></li>
              
                <li>
            <label class="tree-toggler level1">
              <span class="glyphicon glyphicon-minus-sign" style="font-size: 60%; width: 10px; color: grey"></span>
              NanoTwitter
            </label><ul class="tree" style="display: block"><li class=""><a href="/content/nt/01_nt_functionality.md/">nano Twitter Functionality</a></li><li class=""><a href="/content/nt/02_nt_arch.md/">NT Design and Architecture</a></li><li class=""><a href="/content/nt/03_nt_outline.md/">Nano Twitter Project Outline</a></li><li class=""><a href="/content/nt/04_references.md/">Aggregated Twitter Bibliography</a></li></ul></li>
              
                
              
                
              
            </ul>
          </div>
        </div>
      </div>
      <div class="container">
  <div class="row">
    <div class="col-xs-12">
      <footer>Copyright (2014-2015) R. Pito Salas, pitosalas@gmail.com</footer>
      </div>
  </div>
</div>


    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <script src="/bootstrap/js/custom.js"></script>
    <script src="/chalkmark/chalkmark.js"></script>
    <script> $(document).ready(function() {
      $('#tipue_search_input').tipuesearch({'highlightEveryTerm': true, 'show': 8, 'showURL': false, 'descriptiveWords': 50});
    });</script>
  </body>
</html>
